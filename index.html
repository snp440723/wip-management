<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Material Management WIP PIPE B12</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-image: url('S__83050507_0.jpg'); /* กำหนดรูปภาพพื้นหลัง */
            background-size: cover; /* ครอบคลุมพื้นที่ทั้งหมด */
            background-position: center; /* จัดตำแหน่งรูปภาพให้อยู่ตรงกลาง */
            background-attachment: fixed; /* ทำให้รูปภาพพื้นหลังอยู่กับที่เมื่อเลื่อนหน้าจอ */
            background-color: #f0f2f5; /* สีพื้นหลังสำรอง หากรูปภาพโหลดไม่ขึ้น */
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar Styling */
        .sidebar {
            width: 280px;
            background-color: rgba(255, 255, 255, 0.9); /* ปรับความทึบแสงเพื่อให้เห็นพื้นหลัง */
            color: #333;
            padding: 25px 0;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(224, 224, 224, 0.5); /* ปรับความทึบแสง */
        }

        .sidebar-header {
            text-align: center;
            padding: 10px 0 35px;
            border-bottom: 1px solid rgba(240, 240, 240, 0.5); /* ปรับความทึบแสง */
            margin-bottom: 25px;
        }

        .sidebar-header h3 {
            color: #333;
            margin: 0;
            font-size: 1.35em;
            font-weight: 600;
        }

        .sidebar-header p {
            color: #888;
            font-size: 0.9em;
            margin: 8px 0 0;
        }

        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 18px 30px;
            cursor: pointer;
            font-size: 1.05em;
            font-weight: 500;
            color: #555;
            transition: background-color 0.2s ease, color 0.2s ease;
            border-left: 5px solid transparent;
        }

        .menu-item:hover {
            background-color: rgba(245, 245, 245, 0.8); /* ปรับความทึบแสง */
            color: #d9534f;
        }

        .menu-item.active {
            background-color: rgba(253, 232, 232, 0.9); /* ปรับความทึบแสง */
            color: #d9534f;
            border-left: 5px solid #d9534f;
            font-weight: 600;
        }

        .menu-icon {
            width: 22px;
            height: 22px;
            margin-right: 18px;
            fill: currentColor;
        }

        /* Main Content Area */
        .main-content {
            flex-grow: 1;
            padding: 30px 40px;
            background-color: rgba(233, 239, 245, 0.7); /* ปรับความทึบแสงเพื่อให้เห็นพื้นหลัง */
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 35px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(224, 224, 224, 0.5); /* ปรับความทึบแสง */
        }

        .header h2 {
            margin: 0;
            color: #333;
            font-size: 2em;
            font-weight: 600;
        }

        .export-button {
            background-color: #dc3545;
            color: white;
            padding: 10px 22px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.05em;
            font-weight: bold;
            transition: background-color 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .export-button:hover {
            background-color: #c82333;
            box-shadow: 0 3px 6px rgba(0,0,0,0.15);
        }

        /* Content Panel Styling (for each module) */
        .content-panel {
            background-color: rgba(255, 255, 255, 0.9); /* ปรับความทึบแสงเพื่อให้เห็นพื้นหลัง */
            padding: 35px;
            border-radius: 10px;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.08);
            display: none;
            margin-bottom: 30px;
        }

        .content-panel.active {
            display: block;
        }

        /* Form Styling */
        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #555;
            font-size: 0.95em;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group select {
            width: calc(100% - 28px);
            padding: 14px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
            box-sizing: border-box;
            background-color: rgba(253, 253, 253, 0.8); /* ปรับความทึบแสง */
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .form-group input[type="text"]:focus,
        .form-group input[type="number"]:focus,
        .form-group select:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
            outline: none;
        }

        /* Specific styling for dropdown arrows */
        .form-group select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%23888" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
        }

        .save-button {
            background-color: #dc3545;
            color: white;
            padding: 14px 30px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.15em;
            font-weight: bold;
            transition: background-color 0.2s ease, box-shadow 0.2s ease;
            width: auto;
            display: block;
            margin-top: 35px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
        }

        .save-button:hover {
            background-color: #c82333;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* Table Container for Scrollability */
        .table-container {
            margin-top: 15px;
            border: 1px solid rgba(240, 240, 240, 0.5);
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.9);
            overflow: hidden; /* Ensures rounded corners apply to content */
        }
        /* Specific scroll for history tables */
        #receiveHistoryTable.table-container,
        #requestHistoryTable.table-container {
            max-height: 300px; /* Adjust as needed for history tables */
            overflow-y: auto;
        }
        /* Add max-height and overflow-y for reportWIPTable as well if it gets too long */
        #reportWIPTable {
             display: block; /* Make the table a block element to control height */
             max-height: 400px; /* Adjust as needed for report table */
             overflow-y: auto;
             border-collapse: collapse; /* Ensure table collapses borders */
        }
        #reportWIPTable thead {
            position: sticky;
            top: 0;
            z-index: 2; /* Higher z-index to stay above tbody */
            background-color: rgba(248, 248, 248, 0.9); /* Ensure header background is not fully transparent when sticky */
        }
        #reportWIPTable th {
             border-bottom: 2px solid #ddd; /* Add a stronger border for sticky header */
        }


        /* Table Styling */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }

        table th, table td {
            border: 1px solid rgba(240, 240, 240, 0.5); /* ปรับความทึบแสง */
            padding: 12px 15px;
            text-align: left;
        }

        table th {
            background-color: rgba(248, 248, 248, 0.7); /* ปรับความทึบแสง */
            font-weight: 600;
            color: #555;
            text-transform: uppercase;
            font-size: 0.85em;
            position: sticky; /* Make table headers sticky */
            top: 0; /* Stick to the top of the container */
            z-index: 1; /* Ensure header is above scrolling content */
        }

        table tbody tr:nth-child(even) {
            background-color: rgba(250, 250, 250, 0.6); /* ปรับความทึบแสง */
        }

        table tbody tr:hover {
            background-color: rgba(240, 240, 240, 0.7); /* ปรับความทึบแสง */
        }

        /* Search and Filter layout for Dashboard */
        .report-controls {
            display: flex;
            gap: 20px; /* Space between elements */
            margin-bottom: 25px;
            align-items: center;
        }

        .report-controls .form-group {
            margin-bottom: 0; /* Remove default form-group margin */
            flex: 1; /* Allow them to grow */
        }

        .report-controls .form-group label {
            margin-bottom: 5px; /* Adjust label margin */
        }

        #searchReport, #filterProcessReport {
            width: 100%; /* Make them fill their flex container */
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
            box-sizing: border-box;
            background-color: rgba(253, 253, 253, 0.8); /* ปรับความทึบแสง */
        }
        #searchReport:focus, #filterProcessReport:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
            outline: none;
        }
    </style>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <h3>WIP PIPE B12 MANAGEMENT</h3>
            <p>SNC CREATIVITY ANTHOLOGY</p>
        </div>
        <ul class="sidebar-menu">
            <li class="menu-item active" data-tab="receive">
                <img src="data:image/svg+xml;base64,PHN2ZyBhcmlhLWdpZGRlbi0iYnJpY2stZnVsbCIgZGF0YS1iconltaWdlPSJicmFz-ZmFzdCIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIGZpbGw9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIwIiB2aWV3Qm94QXJlYT0iMCAwIDUxMiA1MTIiIHZpZXdCb3hBcmVhPSIwIDAgNTEyIDUxMiIgcGF0aCBkPSJNMjQ4IDMyLjAxQzE1MS4wNCAzMi4wMSAxMDguNjQgODcuMzkgMTA4LjY0IDE2NC4wMUMxMDguNjQgMTg5LjMxIDEwOS43NiAxOTcuOTUgMTEzLjA3IDIwMi40QzExNS45MiAyMDYuMjggMTE4LjA4IDIxMC4wOCAxMjAuMDUgMjEzLjVDMTQ0LjggMjQ3Ljk2IDE4Mi4yMyAyNzcuMzcgMjI4LjQ4IDI5Ni42QzI2Ny44OSAzMTIuMTYgMzA4LjAzIDMzNC4zMyAzMzcuMDIgMzUyLjQ2QzM1Ni43OSAzNjQuNzggMzc2LjU2IDM4OC4xMiAzOTYuNzIgMzg5LjczQzQxMy45NSAzOTkuODIgNDMwLjkgNDA4Ljg1IDQ0OC40IDQxNi45NkM0OTQuOTIgNDM4LjY0IDU0Ny45NiA0MzcuNDQgNTU4LjYgNDQ3Ljc2QzU2NS41MiA0NTQuNDggNTcwLjQ4IDQ2MC42NyA1NzYuMDMgNDY3LjI1QzU4OC4zMiA0ODIuMzEgNTgyLjggNTEyIDU3NiA1MTJIMTA0LjgyQzExLjU5IDUxMiAtNDguNzYgNDE4LjY0IDMyLjAxIDI3My40OUwxNzIuNTkgNDAuMjU1QzE2MS4yOCA4Ljc1NSAxMjcuMjYgLTkuNDQ1IDk0LjMyIC4wMDVDMzkuNzE2IDE2LjgyMzk5OTk5OTk5OTk4IDMuMDM2IDU1LjAxIDEuNDggODUuMjYzQy0yLjA1MiAxNTcuMDkgMi4wMzcgMTgxLjYzIDIuMDM3IDE4MS42M0wyLjAzNyAyNDguMjVDMi4wMzcgMjQ4LjI1IDE5LjkuMjc0LjY1IDczLjk4IDI4Ny4zOEMxMTQuNzUgMjk4LjQ3IDE3OC4zOCAzMjUuNDcgMjIwLjE1IDM2Mi40MkMyNzUuNDcgNDA5LjM3IDM0MS42OCA0MTMuOTIgMzY3LjA3IDQwOC43M0M0NTMuNjcgMzg0Ljg4IDUwNS41MiAzNDkuNzQgNTE3LjQ3IDMzOC43NUM1MjkuNzIgMzI3LjY2IDUzOS42MyAzMTcuNTQgNTUzLjIzIDMwNC4wM0M1NjcuNzggMjkwLjA5IDU4MS4wNCAyNzIuOTkgNTg2.NTcgMjQ4LjIzQzU5NC42NSAyMTYuMDIgNTkyLjczNTQ4IDE3NS4wNCA1NTguODYgMTQ2LjMxRzE1LjIxIDEzNC4zMyA1ODUuNDggMTMwLjgxIDE3NC42NyAxNzQuNjMgNDQyLjUyIDY1Ljk2IDM3Ny41MyAzMi4wMSAyNDggMzIuMDFaIi8+PC9zdmc+" alt="Receive Icon" class="menu-icon">
                Receive WIP
            </li>
            <li class="menu-item" data-tab="report">
                <img src="data:image/svg+xml;base64,PHN2ZyBzdHJva2U9ImN1cnJlbnRDb2xvciIgZmlsbD0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjAiIHZpZXdCb3hBcmVhPSIwIDAgNTEyIDUxMiIgdmlld0JveD0iMCAwIDUxMiA1MTIiIGFyaWEtaGlkZGVuPSJ0cnVlIiBmb2N1c2FibGU9ImZhbHNlIj48cGF0aCBkPSJNNjQgMTQ0SDM4NGMzNS4zNCAwLTY0LTI4LjY2LTY0LTY0VjI0LjAwM0MzMjAtNC4zMzMgMzA0LjA2LTUuNDUzIDI4Ny42NCAxLjgxM0MyNzUuNTcgNi4xMTMgMjYwLjAzIDE0LjE2IDI0OC4wMSAyNi41OUMyMzIuNjUgNDIuMzIgMjIzLjEzIDY2LjIgMjIzLjEzIDg5Ljg5NVMyMjcuNzUgMTE1LjUzIDIyNSAxMTguNSAxOTIgMTEyLjAwNUMxNjAgMTEyLjAwNSAxNDUuNTkgMTA1LjYyIDEyOC4wNiA4Ni4zODdDMTA3LjI1NiA2OC42MjUgMTAxLjQ0IDQ0LjE4NSA5My42Mzg5ODk5OTk5OTk5NSA0Mi42MjVDODAuNTM4OTk5OTk5OTk5OTk5IDM3NDg1NzguNjY4OTk5OTk5OTk5OSAzNi4yMDU3NS44MDkgMzUuMDY1QzQxLjMwOSAyMi41MzkgOC45MzkgNjIuNzY1IDguOTM5IDEwMC42NDVWMjY3Ljc2NUMtNi42NjEgMjkzLjM3MDMzMiAzMy4zNyAzNTMuNzMzNyAzODYuOTEgMzk2LjEyNDg5OTk5OTk5OTk5OTk0NS41MyA0NDkuMjIgMzk5LjY3IDQ0OC4xMSAzNzcuMzkgNDQwLjEwOCA0NzEuNjIgNDkwLjk4IDUyNC41MiA0ODguMDMgNTUzLjA3IDQ4MC41OCAzOC43NiAzOTkuMDggMTEuNTkgNS43MzkgMzMzLjIyNSA0Ny41MzkgMzU1LjQxNTk5OTk5OTk5OTk5OTk5OSAyNzUuNjc5IDM4MS42MDUgMTc0LjIzIDQxMS43MTUgMjUwLjAxIDQxNy42NjVDMjU4LjAxIDQxOC41NTUgMjY0LjY2IDQxOC43MzUgMjcyLjAxIDQxOC41NTVDMjk3LjQ3IDQxNy4wMTUgMzI0LjY2IDQxMC4xNDUgMzQ2LjQ1IDM5Mi4zMzVDMzYwLjQgMzgxLjYxNSAzNzcuNDUgMzY5LjU4NSAzOTcuMzkgMzYxLjUxNEM0MTcuMzUgMzUzLjQ0NSA0MjcuNTUgMzQ0LjgyNSA0NDAuNDUgMzM0Ljg2NEM0NTMuMzcgMzI0LjkxNSA0NjcuNTggMzE3Ljc3NSA0ODAuMTUgMzE3Ljc3NUM1MDkuNzM5OTk5OTk5OTk5OTQ2IDMxNy43NzUgNTEyIDMxOS45MjUgNTEyIDM1MC4zNzVWNDQ4YTY0IDY0IDAgMCAwIDY0IDY0SDUzNmE2NCA2NCAwIDAgMCA2NC02NFYxNDRoNDgwWm0tNjQgNTYuMDA1TDQ4MCAyODguMDA1TDQ4MCAyNTYuMDA1TDUzNiAyNTYuMDA1TDUzNiAyMDAuMDA1Wk00NDggNDQ4YTMyIDMyIDAgMCAwLTMyIDMySDc2YTMyIDMyIDAgMCAwLTMyLTMyVjExNy4yMzVDNzYgNzYuMzE1IDEzOC40NiA3Ljk0NSAxNzUuNzMgNy45NDVIMjQ4LjAxMmM4NS44OSAwIDg3LjYzIDg5LjE3IDg3LjYyNjA3IDg5LjM3aDI4Ljg0OEMzNjQuODUgOTYuOTc1IDM3My4xOCA5OS41NjUgMzc5LjU2IDExNC40ODVDMzkxLjMyIDExMi44NDUgMzk2LjY1IDEyOC4zMzUgMzk2LjY1IDE0Ni4zMjVIMzcwTDMzNy41IDE0NC4wMjVMMzM3IDE3Ni43ODVIMzY5Ljk2TDQ0OCAyMDAuMDA1VjQ0OHoiLz48L3N2Zz4=" alt="Report Icon" class="menu-icon">
                Report WIP
            </li>
            <li class="menu-item" data-tab="request">
                <img src="data:image/svg+xml;base64,PHN2ZyBzdHJva2U9ImN1cnJlbnRDb2xvciIgZmlsbD0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjAiIHZpZXdCb3hBcmVhPSIwIDAgNTc2IDUxMiIgdmlld0JveD0iMCAwIDU3NiA1MTIiIGFyaWEtaGlkZGVuPSJ0cnVlIiBmb2N1c2FibGU9ImZhbHNlIj48cGF0aCBkPSJNMjQ4IDMyLjAxQzE1MS4wNCAzMi4wMSAxMDguNjQgODcuMzkgMTA4LjY0IDE2NC4wMUMxMDguNjQgMTg5LjMxIDEwOS43NiAxOTcuOTUgMTEzLjA3IDIwMi40QzExNS45MiAyMDYuMjggMTE4LjA4IDIxMC4wOCAxMjAuMDUgMjEzLjVDMTQ0LjggMjQ3Ljk2IDE4Mi4yMyAyNzcuMzcgMjI4LjQ4IDI5Ni42QzI2Ny44OSAzMTIuMTYgMzA4LjAzIDMzNC4zMyAzMzcuMDIgMzUyLjQ2QzM1Ni43OSAzNjQuNzggMzc2LjU2IDM4OC4xMiAzOTYuNzIgMzg5LjczQzQxMy45NSAzOTkuODIgNDMwLjkgNDA4Ljg1IDQ0OC40IDQxNi45NkM0OTQuOTIgNDM4LjY0IDU0Ny45NiA0MzcuNDQgNTU4LjYgNDQ3Ljc2QzU2NS41MiA0NTQuNDggNTcwLjQ4IDQ2MC42NyA1NzYuMDMgNDY3LjI1QzU4OC4zMiA0ODIuMzEgNTgyLjggNTEyIDU3NiA1MTJIMTA0LjgyQzExLjU5IDUxMiAtNDguNzYgNDE4LjY0IDMyLjAxIDI3My40OUwxNzIuNTkgNDAuMjU1QzE2MS4yOCA4Ljc1NSAxMjcuMjYgLTkuNDQ1IDk0LjMyIC4wMDVDMzkuNzE2IDE2LjgyMzk5OTk5OTk5OTk4IDMuMDM2IDU1LjAxIDEuNDggODUuMjYzQy0yLjA1MiAxNTcuMDkgMi4wMzcgMTgxLjYzIDIuMDM3IDE4MS42M0wyLjAzNyAyNDguMjVDMi4wMzcgMjQ4LjI1IDE5LjkgOTcuNzUgNzMuOTggMjg3LjM4QzExNC43NSAyOTguNDcgMTc4LjM4IDMyNS40NyAyMjAuMTUgMzYy.NDJDMjc1LjQ3IDQwOS4zNyAzNDEuNjggNDEzLjkyIDM2Ny4wNyA0MDguNzNDNDUzLjY3IDM4NC44OCA1MDUuNTIgMzQ5Ljc0IDUxNy40NyAzMzguNzVDNTI5LjcyIDMyNy42NiA1MzkuNjMgMzE3LjU0IDU1My4yMyAzMDQuMDNDNTY3Ljc4IDI5MC4wOSA1ODEuMDQgMjcyLjk5IDU4Ni41NyAyNDguMjNDNTk0LjY1IDIxNi4wMiA1OTIuNzM1NDggMTc1LjA0IDU1OC44NiAxNDYuMzFUzMTUuMjEgMTM0LjMzIDUxNi43IDExNy45Qzc3OC41NyA5MS4yM0M0NDIuNTIgNjUuOTYgMzc3LjUzIDMyLjAxIDI0OCAzMi4wMVoiLz48L3N2Zz4=" alt="Request Icon" class="menu-icon">
                Request WIP
            </li>
            <li class="menu-item" data-tab="history">
                <img src="data:image/svg+xml;base64,PHN2ZyBzdHJva2U9ImN1cnJlbnRDb2xvciIgZmlsbD0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjAiIHZpZXdCb3hBcmVhPSIwIDAgNTEyIDUxMiIgdmlld0JveD0iMCAwIDUxMiA1MTIiIGFyaWEtaGlkZGVuPSJ0cnVlIiBmb2N1c2FibGU9ImZhbHNlIj48cGF0aCBkPSJNMjU2IDhDMTE5IDggOCAxMTkgOCAyNTZjMCAxMjYuOTIgMTA5LjAzIDIzMS42NiAyMzQuODkgMjQ2Ljg0bDIxLjExIDIxLjA2YyAzLjY4IDMuNjkgOS4wNyA1LjQxIDE0LjQyIDUuMzlINDMxLjQ2YzguMzYgMCAxNS4zNS00LjYgMTcuNzYtMTMuMzlmMjUuMzQtOTEuMTZIMTI4Yy0yNi41MSAwLTQ4LTIxLjQ5LTQ4LTQ4VjE2MGMwLTI2LjUxIDIxLjQ5LTQ4IDQ4LTQ4aDMyMGMyNi41MSAwIDQ4IDIxLjQ5IDQ4IDQ4djE2MEgyNjdjLTEzLjg2IDAtMjUuMTQtMTEuMjctMjUuMTQtMjUuMTRzMTEuMjggLTI1LjE0IDI1LjE0LTI1LjE0SDM2OGMtMTMuODYgMC0yNS4xNC0xMS4yNy0yNS4xNC0yNS4xNHMxMS4yOC0yNS4xNCAyNS4xNC0yNS4xNEg0NDhjNDcuMjUgMCA4NS45My00My40NSA3OS41Ny05MC44NEM1MzIuNjkgMTU3LjE4IDQwMC43MyA4IDI1NiA4em0zOC4zNSAyNTkuNzZsMTkuMjcgNjkuMzZIMjI4LjM2bC0zOS4yMy0xNDEuMjZIMTQzLjQ5bDEyNy4wOS0xMjcuMDljNjIuNTktNjIuNTkgMTY0LjI0LTYyLjU5IDIyNi44NCAwTDE1MS4zOSAyNTQuMTRDMTA2LjczIDIzNC4zMyA1NS44NCAxOTAuMTkgNjQuNzMgMTE2LjU0QzU2LjExIDMxLjEyIDEwNi4xMi00Ni4xOCAyMTAuNi00NC4zMkgyNTYzNDIgbCA2Mi4xMyAyNy41IDY0LjYgNjEuNjZsLTM0LjI1IDEyMi42NnoiLz48L3N2Z24+" alt="History Icon" class="menu-icon">
                History
            </li>
        </ul>
    </div>

    <div class="main-content">
        <div class="header">
            <h2 id="currentModuleTitle">Receive WIP</h2>
            <button id="exportButton" class="export-button" style="display:none;">EXPORT</button>
        </div>

        <div id="receive" class="content-panel active">
            <form id="receiveForm">
                <div class="form-group">
                    <label for="sapCodeReceive">SAP CODE</label>
                    <input type="text" id="sapCodeReceive" placeholder="Enter SAP ID" required>
                </div>
                <div class="form-group">
                    <label for="descriptionReceive">DESCRIPTION</label>
                    <input type="text" id="descriptionReceive" placeholder="Enter Description" required>
                </div>
                <div class="form-group">
                    <label for="quantityReceive">QUANTITY</label>
                    <input type="number" id="quantityReceive" min="1" placeholder="Enter Quantity" required>
                </div>
                <div class="form-group">
                    <label for="unitReceive">UNIT</label>
                    <select id="unitReceive" required>
                        <option value="KG">KG</option>
                        <option value="PCS">PCS</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="typeReceive">TYPE</label>
                    <select id="typeReceive" required>
                        <option value="BOX">BOX</option>
                        <option value="CARS">CARS</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="processReceive">PROCESS</label>
                    <select id="processReceive" required>
                        <option value="">-- Select Process --</option>
                        <option value="CUTTING">CUTTING</option>
                        <option value="BENDING">BENDING</option>
                        <option value="BRAZING">BRAZING</option>
                        <option value="PACKING">PACKING</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="locationReceive">LOCATION</label>
                    <input type="text" id="locationReceive" placeholder="Enter Location" required>
                </div>
                <div class="form-group">
                    <label for="jobOrderReceive">JOBORDER</label>
                    <input type="text" id="jobOrderReceive" placeholder="Enter Job Order" required>
                </div>
                <button type="submit" class="save-button">SAVE</button>
            </form>
        </div>

        <div id="report" class="content-panel">
            <h2>Current WIP Inventory</h2>
            <div class="report-controls">
                <div class="form-group">
                    <label for="searchReport">Search (All Fields)</label>
                    <input type="text" id="searchReport" onkeyup="filterReport()" placeholder="Search...">
                </div>
                <div class="form-group">
                    <label for="filterProcessReport">Filter by Process</label>
                    <select id="filterProcessReport" onchange="filterReport()">
                        <option value="">All Processes</option>
                        <option value="CUTTING">CUTTING</option>
                        <option value="BENDING">BENDING</option>
                        <option value="BRAZING">BRAZING</option>
                        <option value="PACKING">PACKING</option>
                    </select>
                </div>
            </div>
            <div class="table-container">
                <table id="reportWIPTable">
                    <thead>
                        <tr>
                            <th>SAP CODE</th>
                            <th>DESCRIPTION</th>
                            <th>QUANTITY</th>
                            <th>UNIT</th>
                            <th>TYPE</th>
                            <th>PROCESS</th>
                            <th>LOCATION</th>
                            <th>JOBORDER</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="request" class="content-panel">
            <h2>Request WIP</h2>
            <form id="requestForm">
                <div class="form-group">
                    <label for="descriptionRequest">DESCRIPTION</label>
                    <input type="text" id="descriptionRequest" placeholder="Enter Description" required>
                </div>
                <div class="form-group">
                    <label for="quantityRequest">QUANTITY</label>
                    <input type="number" id="quantityRequest" min="1" placeholder="Enter Quantity" required>
                </div>
                <div class="form-group">
                    <label for="unitRequest">UNIT</label>
                    <select id="unitRequest" required>
                        <option value="KG">KG</option>
                        <option value="PCS">PCS</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="jobOrderRequest">JOBORDER</label>
                    <input type="text" id="jobOrderRequest" placeholder="Enter Job Order" required>
                </div>
                <div class="form-group">
                    <label for="requestBy">REQUEST BY</label>
                    <input type="text" id="requestBy" placeholder="Enter Requester Name" required>
                </div>
                <button type="submit" class="save-button">SAVE REQUEST</button>
            </form>
        </div>

        <div id="history" class="content-panel">
            <h2>History</h2>
            <h3 style="margin-top: 20px;">Receive History</h3>
            <div id="receiveHistoryTable" class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Date/Time</th>
                            <th>SAP CODE</th>
                            <th>DESCRIPTION</th>
                            <th>QUANTITY</th>
                            <th>UNIT</th>
                            <th>TYPE</th>
                            <th>PROCESS</th>
                            <th>LOCATION</th>
                            <th>JOBORDER</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>

            <h3 style="margin-top: 40px;">Request History</h3>
            <div id="requestHistoryTable" class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Date/Time</th>
                            <th>DESCRIPTION</th>
                            <th>QUANTITY</th>
                            <th>UNIT</th>
                            <th>JOBORDER</th>
                            <th>REQUEST BY</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Global variable to hold WIP data for filtering
        let allWIPData = [];
        let receiveHistoryData = []; // To store receive history data for export
        let requestHistoryData = []; // To store request history data for export

        document.addEventListener('DOMContentLoaded', () => {
            // Initial load for the first tab
            showContent('receive');
        });

        // --- Sidebar Navigation Logic ---
        const sidebarMenuItems = document.querySelectorAll('.sidebar-menu .menu-item');
        const contentPanels = document.querySelectorAll('.content-panel');
        const currentModuleTitle = document.getElementById('currentModuleTitle');
        const exportButton = document.getElementById('exportButton');

        sidebarMenuItems.forEach(item => {
            item.addEventListener('click', () => {
                const tabId = item.dataset.tab;
                showContent(tabId);
            });
        });

        function showContent(tabId) {
            // Remove active class from all menu items and content panels
            sidebarMenuItems.forEach(item => item.classList.remove('active'));
            contentPanels.forEach(panel => panel.classList.remove('active'));

            // Add active class to the selected menu item and content panel
            const selectedMenuItem = document.querySelector(`.sidebar-menu .menu-item[data-tab="${tabId}"]`);
            const selectedContentPanel = document.getElementById(tabId);

            if (selectedMenuItem) {
                selectedMenuItem.classList.add('active');
            }
            if (selectedContentPanel) {
                selectedContentPanel.classList.add('active');
            }

            // Update Header Title and Export button visibility
            exportButton.style.display = 'none'; // Hide by default

            if (tabId === 'receive') {
                currentModuleTitle.textContent = 'Receive WIP';
            } else if (tabId === 'report') {
                currentModuleTitle.textContent = 'Report WIP';
                exportButton.style.display = 'block';
                exportButton.onclick = exportReportToExcel; // Assign export function
                renderReportTable(); // Refresh report table
            } else if (tabId === 'request') {
                currentModuleTitle.textContent = 'Request WIP';
                // No export on this page, as history is separate
            } else if (tabId === 'history') {
                currentModuleTitle.textContent = 'History';
                exportButton.style.display = 'block';
                exportButton.onclick = exportHistoryToExcel; // Assign combined export for history
                renderReceiveHistoryTable(); // Refresh receive history
                renderRequestHistoryTable(); // Refresh request history
            }
        }

        // --- Receive WIP Form Submission ---
        document.getElementById('receiveForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const sapCode = document.getElementById('sapCodeReceive').value.trim();
            const description = document.getElementById('descriptionReceive').value.trim();
            const quantity = parseInt(document.getElementById('quantityReceive').value);
            const unit = document.getElementById('unitReceive').value;
            const type = document.getElementById('typeReceive').value;
            const process = document.getElementById('processReceive').value;
            const location = document.getElementById('locationReceive').value.trim();
            const jobOrder = document.getElementById('jobOrderReceive').value.trim();

            if (process === "") {
                alert("Please select a PROCESS.");
                return;
            }

            const dataToSend = {
                sapCode,
                description,
                quantity,
                unit,
                type,
                process,
                location,
                jobOrder
            };

            try {
                const response = await fetch('http://localhost:3000/api/wip', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dataToSend)
                });

                if (response.ok) {
                    const result = await response.json();
                    alert('Receive WIP data saved successfully!');
                    console.log('API Response:', result);
                    document.getElementById('receiveForm').reset();
                    // No need to call renderReportTable() here immediately unless on the 'report' tab
                    // It will be called when user switches to 'report' tab
                } else {
                    const errorText = await response.text();
                    alert('Failed to save Receive WIP data: ' + errorText);
                    console.error('API Error:', response.status, errorText);
                }
            } catch (error) {
                alert('Error connecting to the server. Please ensure the backend is running.');
                console.error('Fetch error:', error);
            }
        });

        // --- Request WIP Form Submission ---
        document.getElementById('requestForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const description = document.getElementById('descriptionRequest').value.trim();
            const quantity = parseInt(document.getElementById('quantityRequest').value);
            const unit = document.getElementById('unitRequest').value;
            const jobOrder = document.getElementById('jobOrderRequest').value.trim();
            const requestBy = document.getElementById('requestBy').value.trim();

            const dataToSend = {
                description,
                quantity,
                unit,
                jobOrder,
                requestBy
            };

            try {
                const response = await fetch('http://localhost:3000/api/request-wip', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dataToSend)
                });

                if (response.ok) {
                    const result = await response.json();
                    alert('Request submitted successfully!');
                    console.log('API Response:', result);
                    document.getElementById('requestForm').reset();
                    // No need to call render tables here immediately unless on the 'report' or 'history' tab
                } else {
                    const errorText = await response.text();
                    alert('Failed to submit request: ' + errorText);
                    console.error('API Error:', response.status, errorText);
                }
            } catch (error) {
                alert('Error connecting to the server. Please ensure the backend is running.');
                console.error('Fetch error:', error);
            }
        });

        // --- Functions to fetch and render data from API ---

        // Function to fetch and render current WIP table
        async function renderReportTable() {
            const tableBody = document.querySelector('#reportWIPTable tbody');
            tableBody.innerHTML = ''; // Clear existing rows

            try {
                const response = await fetch('http://localhost:3000/api/wip');
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                allWIPData = await response.json(); // Store fetched data for filtering
                renderFilteredReportTable(allWIPData); // Render initially with all data
            } catch (error) {
                console.error('Error fetching current WIP data:', error);
                tableBody.innerHTML = '<tr><td colspan="8">Failed to load WIP data. Please check server connection.</td></tr>';
            }
        }

        // Function to render table based on filtered data (used by renderReportTable and filterReport)
        function renderFilteredReportTable(dataToRender) {
            const tableBody = document.querySelector('#reportWIPTable tbody');
            tableBody.innerHTML = ''; // Clear existing rows

            if (dataToRender.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8">No matching data found.</td></tr>';
                return;
            }

            dataToRender.forEach(item => {
                const row = tableBody.insertRow();
                // Ensure column names match your PostgreSQL table schema (snake_case)
                row.insertCell().textContent = item.sap_code;
                row.insertCell().textContent = item.description;
                row.insertCell().textContent = item.quantity;
                row.insertCell().textContent = item.unit;
                row.insertCell().textContent = item.type;
                row.insertCell().textContent = item.process;
                row.insertCell().textContent = item.location;
                row.insertCell().textContent = item.job_order;
            });
        }

        // Function to filter report table based on search and process filter
        function filterReport() {
            const searchTerm = document.getElementById('searchReport').value.toLowerCase();
            const filterProcess = document.getElementById('filterProcessReport').value;

            const filteredData = allWIPData.filter(item => {
                const matchesSearch = Object.values(item).some(value =>
                    String(value).toLowerCase().includes(searchTerm)
                );
                const matchesProcess = filterProcess === "" || item.process === filterProcess;
                return matchesSearch && matchesProcess;
            });

            renderFilteredReportTable(filteredData);
        }

        // Function to fetch and render Receive History table
        async function renderReceiveHistoryTable() {
            const tableBody = document.querySelector('#receiveHistoryTable tbody');
            tableBody.innerHTML = ''; // Clear existing rows

            try {
                const response = await fetch('http://localhost:3000/api/receive-history');
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                receiveHistoryData = await response.json(); // Store data for export
                
                if (receiveHistoryData.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="9">No receive history found.</td></tr>';
                    return;
                }

                receiveHistoryData.forEach(item => {
                    const row = tableBody.insertRow();
                    // Format date/time
                    const date = new Date(item.timestamp);
                    const formattedTimestamp = date.toLocaleDateString('th-TH', {
                        year: 'numeric', month: '2-digit', day: '2-digit'
                    }) + ' ' + date.toLocaleTimeString('th-TH', {
                        hour: '2-digit', minute: '2-digit'
                    });

                    row.insertCell().textContent = formattedTimestamp;
                    row.insertCell().textContent = item.sap_code;
                    row.insertCell().textContent = item.description;
                    row.insertCell().textContent = item.quantity;
                    row.insertCell().textContent = item.unit;
                    row.insertCell().textContent = item.type;
                    row.insertCell().textContent = item.process;
                    row.insertCell().textContent = item.location;
                    row.insertCell().textContent = item.job_order;
                });
            } catch (error) {
                console.error('Error fetching receive history data:', error);
                tableBody.innerHTML = '<tr><td colspan="9">Failed to load Receive History. Please check server connection.</td></tr>';
            }
        }

        // Function to fetch and render Request History table
        async function renderRequestHistoryTable() {
            const tableBody = document.querySelector('#requestHistoryTable tbody');
            tableBody.innerHTML = ''; // Clear existing rows

            try {
                const response = await fetch('http://localhost:3000/api/request-history');
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                requestHistoryData = await response.json(); // Store data for export

                if (requestHistoryData.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="6">No request history found.</td></tr>';
                    return;
                }

                requestHistoryData.forEach(item => {
                    const row = tableBody.insertRow();
                    const date = new Date(item.timestamp);
                    const formattedTimestamp = date.toLocaleDateString('th-TH', {
                        year: 'numeric', month: '2-digit', day: '2-digit'
                    }) + ' ' + date.toLocaleTimeString('th-TH', {
                        hour: '2-digit', minute: '2-digit'
                    });

                    row.insertCell().textContent = formattedTimestamp;
                    row.insertCell().textContent = item.description;
                    row.insertCell().textContent = item.quantity;
                    row.insertCell().textContent = item.unit;
                    row.insertCell().textContent = item.job_order;
                    row.insertCell().textContent = item.request_by;
                });
            } catch (error) {
                console.error('Error fetching request history data:', error);
                tableBody.innerHTML = '<tr><td colspan="6">Failed to load Request History. Please check server connection.</td></tr>';
            }
        }

        // --- Export Functions ---

        function exportReportToExcel() {
            if (allWIPData.length === 0) {
                alert("No data to export for Report WIP.");
                return;
            }

            const ws = XLSX.utils.json_to_sheet(allWIPData.map(item => ({
                "SAP CODE": item.sap_code,
                "DESCRIPTION": item.description,
                "QUANTITY": item.quantity,
                "UNIT": item.unit,
                "TYPE": item.type,
                "PROCESS": item.process,
                "LOCATION": item.location,
                "JOBORDER": item.job_order
            })));
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Current WIP Report");
            XLSX.writeFile(wb, "Current_WIP_Report.xlsx");
        }

        async function exportHistoryToExcel() {
            // Ensure data is loaded before attempting to export
            await renderReceiveHistoryTable(); // Make sure receiveHistoryData is populated
            await renderRequestHistoryTable(); // Make sure requestHistoryData is populated

            const wb = XLSX.utils.book_new();

            // Export Receive History
            if (receiveHistoryData.length > 0) {
                const receiveExportData = receiveHistoryData.map(item => {
                    const date = new Date(item.timestamp);
                    const formattedTimestamp = date.toLocaleDateString('th-TH', {
                        year: 'numeric', month: '2-digit', day: '2-digit'
                    }) + ' ' + date.toLocaleTimeString('th-TH', {
                        hour: '2-digit', minute: '2-digit'
                    });
                    return {
                        "Date/Time": formattedTimestamp,
                        "SAP CODE": item.sap_code,
                        "DESCRIPTION": item.description,
                        "QUANTITY": item.quantity,
                        "UNIT": item.unit,
                        "TYPE": item.type,
                        "PROCESS": item.process,
                        "LOCATION": item.location,
                        "JOBORDER": item.job_order
                    };
                });
                const wsReceive = XLSX.utils.json_to_sheet(receiveExportData);
                XLSX.utils.book_append_sheet(wb, wsReceive, "Receive History");
            } else {
                console.warn("No receive history data to export.");
            }

            // Export Request History
            if (requestHistoryData.length > 0) {
                const requestExportData = requestHistoryData.map(item => {
                    const date = new Date(item.timestamp);
                    const formattedTimestamp = date.toLocaleDateString('th-TH', {
                        year: 'numeric', month: '2-digit', day: '2-digit'
                    }) + ' ' + date.toLocaleTimeString('th-TH', {
                        hour: '2-digit', minute: '2-digit'
                    });
                    return {
                        "Date/Time": formattedTimestamp,
                        "DESCRIPTION": item.description,
                        "QUANTITY": item.quantity,
                        "UNIT": item.unit,
                        "JOBORDER": item.job_order,
                        "REQUEST BY": item.request_by
                    };
                });
                const wsRequest = XLSX.utils.json_to_sheet(requestExportData);
                XLSX.utils.book_append_sheet(wb, wsRequest, "Request History");
            } else {
                console.warn("No request history data to export.");
            }

            if (receiveHistoryData.length > 0 || requestHistoryData.length > 0) {
                XLSX.writeFile(wb, "WIP_History_Report.xlsx");
            } else {
                alert("No history data (Receive or Request) to export.");
            }
        }
    </script>
</body>
</html>
